# Сервис Нотификаций

## Описание

**Сервис Нотификаций** — это система для управления и отправки уведомлений пользователям через различные каналы доставки (Email, SMS, Push). Сервис включает в себя административную панель для создания и управления рассылками, API для обработки событий, воркеры для формирования и отправки сообщений, а также WebSocket сервер для мгновенных уведомлений.

## Возможности

1. **Админка для создания рассылок:**
   - Создание сообщений с выбором способа доставки.
   - CRUD операции для шаблонов сообщений.
   - Отложенные сообщения.
   - Повторяющиеся сообщения.

2. **Сервис Нотификаций:**
   - Обработка фиксированных событий (регистрация пользователя, добавление нового фильма и др.).
   - Обработка событий в произвольном формате.
   - Центральный узел, принимающий заявки и отправляющий их в очередь (RabbitMQ).

3. **Воркеры:**
   - Извлечение сообщений из очереди.
   - Отправка сообщений пользователям или передача их в другую очередь для дальнейшей обработки.

4. **WebSocket сервер:**
   - Мгновенная доставка сообщений.
   - Авторизация для обеспечения безопасности соединений.

5. **Сервис Авторизации:**
   - Отдельно развернутый сервис авторизации доступен по адресу [http://35.156.176.160/api/auth/openapi](http://35.156.176.160/api/auth/openapi).
   - Воркеры обращаются к этому сервису для получения информации о пользователях (например, email и ФИО) на основе `user_id`.

## Технологии

- **Backend:**
  - Django / FastAPI 
  - Celery для асинхронных задач
  - Celery-Beat для отложенных задач
  - RabbitMQ для очередей сообщений
  - Redis для кэширования и хранения результатов Celery
  - PostgreSQL для базы данных
  - Mongo для хранения истории уведомлений
  - WebSockets

- **Frontend:**
  - Административная панель на Django Admin или другом фреймворке

- **Инфраструктура:**
  - Docker & Docker Compose для контейнеризации сервисов
  - Nginx в качестве обратного прокси-сервера

## Структура Проекта

```
notifications_sprint_1/
├── admin/                  # Исходный код административной панели
├── notification_service/   # Исходный код сервиса нотификаций
├── ws/                     # Исходный код WebSocket сервера
├── nginx/                  # Конфигурация Nginx
├── docker-compose.yml      # Docker Compose файл
├── .env                    # Файл переменных окружения
└── README.md               # Документация проекта
```

## Установка

### Требования

- [Docker](https://www.docker.com/get-started)
- [Docker Compose](https://docs.docker.com/compose/install/)

### Шаги установки

1. **Клонируйте репозиторий:**

   ```bash
   git clone git@github.com:stybayev/notifications_sprint_1.git
   ```

2) Заходим в корневую директрию проекта `/notifications_sprint_1`:
   ```
   notifications_sprint_1
   ```
3) Создаем файл `.env` и копируем в него содержимое файла `.env.example`:
   ```
   cp .env.example .env
   ```
4) Запускаем сервисы:
   ```
   docker-compose -f docker-compose.mongo.yml -f docker-compose.yml  up --build 
   ```
5) Все должно работать!


## Использование

### Административная панель

Админка доступна по адресу [http://localhost/admin](http://localhost:8080). Здесь менеджеры могут создавать и управлять рассылками, выбирать шаблоны сообщений, настраивать отложенные и повторяющиеся сообщения.

### API Сервиса Нотификаций

Сервис нотификаций доступен по адресу http://0.0.0.0:8000/api/notification/openapi. 

Предоставляет API для обработки событий и управления уведомлениями. Он принимает заявки и отправляет их в очередь RabbitMQ для дальнейшей обработки воркерами.

### WebSocket Сервер

WebSocket сервер (ws://localhost/ws) обеспечивает мгновенную доставку уведомлений пользователям. Подключение к серверу требует авторизации для обеспечения безопасности.

### Воркеры

Воркеры обрабатывают сообщения из очереди, формируют уведомления на основе шаблонов и отправляют их пользователям через выбранные каналы доставки.

## Конфигурация

Все конфигурации управляются через файл `.env`. Убедитесь, что все необходимые переменные окружения правильно настроены перед запуском сервисов.

## Тестирование

Для тестирования сервисов используйте предоставленные Docker контейнеры или настройте локальную среду разработки. Убедитесь, что все сервисы запущены и правильно настроены.

*Этот проект разработан в рамках спринта по созданию сервиса нотификаций.*